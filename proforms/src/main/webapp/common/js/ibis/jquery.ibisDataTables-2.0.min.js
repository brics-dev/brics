/**
 * IBIS DataTables 2.0
 * 
 * Contains all files needed to perform the IBIS DataTables javascript
 * processes.
 * 
 * Contents:
 * OpButtonController 	Controls buttons on top of datatables
 * DataTableLanguage
 * Row
 * TableCol
 * Rows
 * TableCols
 * DataTable		-	Model for an individual DataTable
 * DataTables		-	Collection of DataTable models
 * DataTableView	-	View class for rendering the datatable
 * DataTableViews	-	Collection of DataTableView classes
 * IBISDataTables	-	API Class for other developers to interface with
 * 
 */

// OpButtonController
var OpButtonController={initialized:!1,noneSelected:function(e){e.hasClass("alwaysEnabled")||e.hasClass("enabledOnNone")?e.prop("disabled",!1):e.prop("disabled",!0)},oneSelected:function(e){e.hasClass("alwaysDisabled")?e.prop("disabled",!0):e.prop("disabled",!1)},manySelected:function(e){e.hasClass("alwaysEnabled")||e.hasClass("enabledOnMany")?e.prop("disabled",!1):e.prop("disabled",!0)},initTable:function(e){var t=e.parent().parent().children("ul");if(t.length>0){var n=e.parent().children(":first");$(n).prepend($(t))}$(".ui-widget-header").append('<div class="clearboth"></div>'),$('.dataTableContainer input[type="submit"], .dataTableContainer input[type="button"], .dataTableContainer button').prop("disabled",!0),$('.dataTableContainer input[type="button"].alwaysEnabled, .dataTableContainer button.alwaysEnabled, .dataTableContainer input[type="button"].enabledOnNone, .dataTableContainer button.enabledOnNone').prop("disabled",!1),$('.dataTableContainer input[type="submit"].alwaysEnabled, .dataTableContainer submit.alwaysEnabled, .dataTableContainer input[type="submit"].enabledOnNone, .dataTableContainer submit.enabledOnNone').prop("disabled",!1),this.initialized||(EventBus.on("select:row",function(e,t){this.selectedChange(null,t.get("$el"))},this),EventBus.on("deselect:row",function(e,t){this.selectedChange(null,t.get("$el"))},this),EventBus.on("select:all",function(e){this.selectedChange(null,e.get("$el"))},this),EventBus.on("deselect:all",function(e){this.selectedChange(null,e.get("$el"))},this),EventBus.on("select:set",function(e,t){this.selectedChange(null,t.get("$el"))},this),this.initialized=!0)},drawRedrawTable:function(e){e.find('input[type="button"], button').each(function(){OpButtonController.noneSelected($(this))})},selectedChange:function(e,t){var n=0,a=$();n=IDT.countSelectedOptions("undefined"==typeof t?IDT.getTable(e):t),a=IDT.getTableContainer("undefined"==typeof t?e:t),a.find('input[type="submit"], input[type="button"], button').each(function(){1>n?OpButtonController.noneSelected($(this)):1==n?OpButtonController.oneSelected($(this)):OpButtonController.manySelected($(this))})}};

// DataTableLanguage
var DataTableLanguage={language:function(){return"undefined"==typeof language||""==language?this.oLanguage_en_US:language.indexOf("zh")>-1?this.oLanguage_zh_TW:language.indexOf("es")>-1?this.oLanguage_es:this.oLanguage_en_US},oLanguage_en_US:{oAria:{sSortAscending:": activate to sort column ascending",sSortDescending:": activate to sort column descending"},oPaginate:{sFirst:"First",sLast:"Last",sNext:"Next",sPrevious:"Previous"},sEmptyTable:"No data available in table",sInfo:"Showing _START_ to _END_ of _TOTAL_ entries",sInfoEmpty:"Showing 0 to 0 of 0 entries",sInfoFiltered:"(filtered from _MAX_ total entries)",sInfoPostFix:"",sInfoThousands:",",sLengthMenu:"Show _MENU_ entries",sLoadingRecords:"Loading...",sProcessing:"Processing...",sSearch:"Search:",sUrl:"",sZeroRecords:"No matching records found"},oLanguage_zh_TW:{sProcessing:"\u8655\u7406\u4e2d...",sLengthMenu:"\u986f\u793a _MENU_ \u9805\u7d50\u679c",sZeroRecords:"\u6c92\u6709\u5339\u914d\u7d50\u679c",sInfo:"\u986f\u793a\u7b2c _START_ \u81f3 _END_ \u9805\u7d50\u679c\uff0c\u5171 _TOTAL_ \u9805",sInfoEmpty:"\u986f\u793a\u7b2c 0 \u81f3 0 \u9805\u7d50\u679c\uff0c\u5171 0 \u9805",sInfoFiltered:"(\u5f9e _MAX_ \u9805\u7d50\u679c\u904e\u6ffe)",sInfoPostFix:"",sSearch:"\u641c\u7d22:",sUrl:"",oPaginate:{sFirst:"\u9996\u9801",sPrevious:"\u4e0a\u9801",sNext:"\u4e0b\u9801",sLast:"\u5c3e\u9801"}},oLanguage_sp:{sProcessing:"Procesando...",sLengthMenu:"Mostrar _MENU_ registros",sZeroRecords:"No se encontraron resultados",sEmptyTable:"Ning\xfan dato disponible en esta tabla",sInfo:"Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",sInfoEmpty:"Mostrando registros del 0 al 0 de un total de 0 registros",sInfoFiltered:"(filtrado de un total de _MAX_ registros)",sInfoPostFix:"",sSearch:"Buscar:",sUrl:"",sInfoThousands:",",sLoadingRecords:"Cargando...",oPaginate:{sFirst:"Primero",sLast:"\xdaltimo",sNext:"Siguiente",sPrevious:"Anterior"},fnInfoCallback:null,oAria:{sSortAscending:": Activar para ordernar la columna de manera ascendente",sSortDescending:": Activar para ordernar la columna de manera descendente"}}};

// Row
var Row=BaseModel.extend({defaults:{saveValue:"",data:[],expandedData:"",expandedDataIndex:-1,index:-1,disabled:false},initialize:function(){this.set("saveValue",IDT.getSaveValue(this))},html:function(){var e=this.get("data");var t="<tr>";for(var n=0;n<e.length;n++){t+="<td>"+e[n]+"</td>"}t+="</tr>";return t},getCellDataHtml:function(e){var t=this.get("data");if(e>0&&e<t.length){return t[e]}return undefined},getCellDataText:function(e){var t=this.get("data");if(e>0&&e<t.length){var n=t[e];return $(n).text()}return undefined},getInput:function(){var e=$();var t=this.get("data")[0];try{e=$(t)}catch(n){}return e}});

// TableCol
var TableCol=BaseModel.extend({defaults:{sortable:!0,visible:!0,title:"",index:0},initialize:function(){},dtObj:function(){return{}}});

// Rows
var Rows=Backbone.Collection.extend({initialize:function(){this.model=Row},bySaveVal:function(a){return this.findWhere({saveValue:a})}});

// TableCols
var TableCols=Backbone.Collection.extend({initialize:function(){this.model=TableCol},indexByName:function(a){return this.findWhere({title:a})}});

// DataTable
var DataTable=BaseModel.extend({rows:null,columns:null,selectedRows:null,defaults:{id:null,rendered:!1,$el:null,aaData:[],aoColumns:[],datatable:null,inputType:"none",exportRow:"",selectionDisable:!1,disableSelectAll:!1,config:{},expandedDataIndex:-1},initialize:function(){this.rows=new Rows,this.columns=new TableCols,this.selectedRows=new Rows},loadData:function(e){this.loadColumns(e.aoColumns),this.loadRows(e.aaData)},loadColumns:function(e){this.set("aoColumns",e);for(var t=0;t<e.length;t++){var s=e[t],i=!("ibisDatatable_expandedData"==s.sTitle),n=!0;0==t&&"none"!==this.get("inputType")&&(n=!1),this.columns.create({title:s.sTitle,sortable:n,visible:i,index:t})}},loadRows:function(e){this.set("aaData",e);for(var t=this.get("expandedDataIndex"),s=0;s<this.columns.length;s++)if(this.columns.at(s).get("visible")===!1){t=s;break}this.set("expandedDataIndex",t);for(var i=0;i<e.length;i++){var n=this.loadSingleRow(e[i]);this.determineDisabledRow(n)}},loadSingleRow:function(e){var t=this.get("expandedDataIndex");if(e.length>0){var s="";t>=0&&(s=e[t]);var i=this.rows.length,e=this.rows.create({saveValue:null,data:e,expandedData:s,expandedDataIndex:t,index:i});return e}},removeSingleRow:function(e){this.deselectRow(e.get("saveValue")),e.set("index",this.rows.indexOf(e)),this.rows.remove(e)},addNewRow:function(e){e instanceof Row?this.loadSingleRow(e.get("data")):this.loadSingleRow(e)},removeRow:function(e){var t=this.row(e);"undefined"!=typeof t&&this.removeSingleRow(t)},removeAllRows:function(){for(var e=this.rows.toArray(),t=e.length;t>0;t--)this.removeSingleRow(e[t-1])},toggleRow:function(e){var t=this.row(e);"undefined"==typeof t||this.get("selectionDisable")||("radio"==this.get("inputType")&&this.deselectAll(),this.isSelected(t)?(this.removeSelectedRow(t),EventBus.trigger("deselect:row",e,this)):(this.addSelectedRow(t),EventBus.trigger("select:row",e,this)))},selectRow:function(e){var t=this.row(e);"undefined"==typeof t||this.get("selectionDisable")||("radio"==this.get("inputType")&&this.deselectAll(),this.isSelected(t)||(this.addSelectedRow(t),EventBus.trigger("select:row",e,this)))},deselectRow:function(e){var t=this.row(e);"undefined"!=typeof t&&this.isSelected(t)&&!this.get("selectionDisable")&&(this.removeSelectedRow(t),EventBus.trigger("deselect:row",e,this))},selectSet:function(e){for(var t=0;t<e.length;t++)this.selectRow(e[t]);EventBus.trigger("select:set",e,this)},deselectAll:function(){for(var e=this.selectedRows.length,t=0;e>t;t++)this.selectedRows.pop();EventBus.trigger("deselect:all",this)},selectAll:function(){for(var e=this.rows.length,t=0;e>t;t++)this.addSelectedRow(this.rows.at(t));EventBus.trigger("select:all",this)},addSelectedRow:function(e){e.get("disabled")===!1&&this.selectedRows.add(e)},removeSelectedRow:function(e){this.selectedRows.remove(e)},row:function(e){return this.rows.findWhere({saveValue:e})},hasRow:function(e){return this.row(e)?!0:!1},isSelected:function(e){return this.selectedRows.contains(e)},isSelectedSaveVal:function(e){var t=this.row(e);return this.isSelected(t)},getSelectedSaveVals:function(){var e=[];return this.selectedRows.each(function(t){e.push(t.get("saveValue"))}),e},rowByValue:function(e){return this.row(e)},cellData:function(e,t){var s=[];"undefined"==typeof t&&(t=!1);var i=this.columns.indexByName(e);if(i){colIndex=i.get("index");for(var n=0;n<this.selectedRows.length;n++){var o=this.selectedRows.at(n);t?s.push(o.getCellDataText(colIndex)):s.push(o.getCellDataHtml(colIndex))}}else s=[""];return s},determineDisabledRow:function(e){e.getInput().is(":disabled")&&this.disableRowByModel(e)},disableSingleRow:function(e){this.disableRowByModel(this.rowByValue(e))},disableRowByModel:function(e){e.set("disabled",!0),EventBus.trigger("disable:row",this,e)},enableSingleRow:function(e){var t=this.rowByValue(e);t.set("disabled",!1),EventBus.trigger("enable:row",this,t)}});

// DataTables
var DataTables=Backbone.Collection.extend({initialize:function(){this.model=DataTable}});

// DataTableView
var DataTableView=BaseView.extend({exportRow:null,baseConfig:{bJQueryUI:!0,bDeferRender:!0,bLengthChange:!1,iDisplayLength:15,bProcessing:!0,bAutoWidth:!1,sPaginationType:"full_numbers",aaSorting:[],fnInitComplete:function(e,t){OpButtonController.initTable($(this)),"function"==typeof fnInitComplete&&fnInitComplete(e,t)},fnRowCallback:function(e,t,l,i){"function"==typeof fnRowCallback&&fnRowCallback(e,t,l,iDisplayIndexFull)},fnPreDrawCallback:function(e){},fnDrawCallback:function(e){var t=$(this).parents(".dataTableContainer");$table=t.find("table").eq(0);var l=IDT.getTableModel($table);"function"==typeof fnDrawCallback&&fnDrawCallback(t),EventBus.trigger("draw:table",l)},fnCreatedRow:function(e,t,l){}},events:{'click input[type="checkbox"]':"selectCheckbox",'click input[type="radio"]':"selectRadio","click tr":"selectRow","click .selectAll":"selectAll","click .selectFilter":"selectFiltered","click .selectNone":"selectNone"},initialize:function(){this.$el=this.model.get("$el"),this.listenTo(this.model.selectedRows,"add",this.onAddSelectedRow),this.listenTo(this.model.selectedRows,"remove",this.onRemoveSelectedRow),this.listenTo(this.model.rows,"add",this.onAddRow),this.listenTo(this.model.rows,"remove",this.onRemoveRow),EventBus.on("draw:table",this.onDraw,this),EventBus.on("derender:table",this.deRender,this),EventBus.on("disable:row",this.disableSingleRow,this),EventBus.on("enable:row",this.enableSingleRow,this),EventBus.on("filter:table",this.filterTable,this)},render:function(){var e={aaData:this.model.get("aaData"),aoColumns:this.model.get("aoColumns")};this.determineInputType(e),this.createTransformDom(),this.startupDatatables(e),this.initInfoRow(),this.setStyles(),this.drawSelectAll(),this.isVisible()||this.listenForVisible(),EventBus.trigger("init:table",this.model)},startupDatatables:function(e){var t=$.extend({},this.config,e,this.specificConfig());this.model.loadData(e);var l=this.$el.dataTable(t),i=this.model.get("id");this.model.set("datatable",l),this.model.set("rendered",!0),IDT.dataTables[i]=l},specificConfig:function(){var e={};e.oLanguage=DataTableLanguage.language();var t=[];"none"!=this.model.get("inputType")&&(t[0]=0),e.aoColumnDefs=[{bSortable:!1,aTargets:t,bSearchable:!1},{sDefaultContent:"none",aTargets:["_all"]}];var l=this.model.get("config")||{};return $.extend({},this.baseConfig,e,l)},determineInputType:function(e){var t="none";if(e.aaData.length>0)try{var l=$(e.aaData[0][0]).eq(0);l.length>0&&(l.is('[type="radio"]')||l.find('[type="radio"]').length>0?t="radio":(l.is('input[type="checkbox"]')||l.find('input[type="checkbox"]').length>0)&&(t="checkbox"))}catch(i){}this.model.set("inputType",t)},getHeaderCells:function(){var e=this.$el,t=$("> tbody > tr > th",e),l=$("> tr > th",e),i=$("> thead > tr > td",e),n=$();n=t.length>0?t:l.length>0?l:i.length>0?i:e.find("tr").eq(0);for(var a=[],o=0;o<n.length;o++){var s=n.eq(o);if(s.hasClass("ibisDatatable_expandedData"))a.push({bVisible:!1});else{var r=s.attr("colspan");r||(r=1);for(var c=0;r>c;c++)a.push({sTitle:s.text()})}}return this.model.set("aoColumns",a),n},getBodyRows:function(e){var t=[],l=$("> tbody > tr",e),i=$("> tr",e),n=$();n=l.length>0?l:i;for(var a=0;a<n.length;a++){for(var o=n.eq(a),s=[],r=o.children("td"),c=0;c<r.length;c++)s.push(r.eq(c).html());t.push(s)}return this.model.set("aaData",t),n},setStyles:function(){this.$("thead tr").addClass("tableRowHeader").attr("role","row"),this.$("th").addClass("tableCellHeader").attr("role","columnheader")},drawSelectAll:function(){var e=this.model.get("inputType");if("none"!=e&&"radio"!=e){var t=this.$el.find("th.tableCellHeader").eq(0),l='<nav class="idtNav"><ul><li class="selectAllIcon"><img src="'+baseUrl+'/formbuilder/images/checkbox_unchecked.png" />';l+='<ul><li><a href="javascript:;" class="selectAllMenu selectAll"><img src="'+baseUrl+'/formbuilder/images/checkbox_checked.png" />Select All</a></li>',l+='<li><a href="javascript:;" class="selectAllMenu selectFilter"><img src="'+baseUrl+'/formbuilder/images/checkbox_indeterminate.png" />Select Filtered</a></li>',l+='<li><a href="javascript:;" class="selectAllMenu selectNone"><img src="'+baseUrl+'/formbuilder/images/checkbox_unchecked.png" />Select None</a></li>',l+="</ul></li></nav>",t.html(l),this.determineSelectAllIcon()}},determineSelectAllIcon:function(){var e=this.model.selectedRows.length,t=this.model.rows.length;e==t?this.selectAllIconToChecked():e>0?this.selectAllIconToPartial():this.selectAllIconToUnchecked()},selectAllIconToChecked:function(){var e=this.model.get("inputType");"none"!=e&&"radio"!=e&&this.$(".selectAllIcon > img").attr("src",baseUrl+"/formbuilder/images/checkbox_checked.png")},selectAllIconToPartial:function(){var e=this.model.get("inputType");"none"!=e&&"radio"!=e&&this.$(".selectAllIcon > img").attr("src",baseUrl+"/formbuilder/images/checkbox_indeterminate.png")},selectAllIconToUnchecked:function(){var e=this.model.get("inputType");"none"!=e&&"radio"!=e&&this.$(".selectAllIcon > img").attr("src",baseUrl+"/formbuilder/images/checkbox_unchecked.png")},createTransformDom:function(){},rowHasInput:function(e){var t=IDT.getInputForRow(e);return t.length>0?t:!1},onDraw:function(e){var t=this;_.isEqual(e,this.model)&&this.$el.find("tbody tr").each(function(){var e=$(this),l=IDT.getInputForRow(e),i=IDT.getSaveValue(l);t.model.isSelectedSaveVal(i)?(t.setRowSelected(e),l.prop("checked",!0)):(t.setRowDeselected(e),l.prop("checked",!1))})},onAddSelectedRow:function(e,t){this.select(e),this.updateSelectedItemCount(),this.determineSelectAllIcon()},onRemoveSelectedRow:function(e,t){this.deselect(e),this.updateSelectedItemCount(),this.determineSelectAllIcon()},onAddRow:function(e,t){if(this.model.get("rendered")===!0){var l=this.model.get("datatable");l.fnAddData(e.get("data"))}},onRemoveRow:function(e,t){if(this.model.get("rendered")===!0){var l=this.model.get("datatable");l.fnDeleteRow(e.get("index"))}},select:function(e){var t=this.getRowJqueryBySaveValue(e.get("saveValue"));t.length>0&&(this.findInputOnRow(t).prop("checked",!0),this.setRowSelected(t))},deselect:function(e){var t=this.getRowJqueryBySaveValue(e.get("saveValue"));t.length>0&&(this.findInputOnRow(t).prop("checked",!1),this.setRowDeselected(t))},setRowSelected:function(e){e.hasClass("row_selected")||e.addClass("row_selected")},setRowDeselected:function(e){e.removeClass("row_selected")},selectCheckbox:function(e){e.stopImmediatePropagation();var t=$(e.target),l=IDT.getSaveValue(t);this.model.toggleRow(l)},selectRadio:function(e){e.stopImmediatePropagation();var t=$(e.target);e.stopImmediatePropagation();var l=IDT.getSaveValue(t);this.model.toggleRow(l)},selectRow:function(e){if(e.stopImmediatePropagation(),!$(e.target).is("a, input, select, label")){var t=IDT.getInputForRow($(e.currentTarget));t.length>0&&this.model.toggleRow(IDT.getSaveValue(t))}},selectAll:function(e){e.stopImmediatePropagation(),this.model.get("disableSelectAll")||this.model.selectAll()},selectFiltered:function(e){if(e.stopImmediatePropagation(),!this.model.get("disableSelectAll")){var t=this.model.get("datatable");try{for(var l=t._("tr",{filter:"applied"}),i=l.length,n=[],a=0;i>a;a++){var o=l[a],s=$(o[0]);s.length>0&&n.push(IDT.getSaveValue(s))}this.model.selectSet(n)}catch(r){this.selectAll(e)}}},selectNone:function(e){e.stopImmediatePropagation(),this.model.get("disableSelectAll")||this.model.deselectAll()},disableSingleRow:function(e,t){if(_.isEqual(e,this.model)){var l=t.get("saveValue"),i=this.getRowJqueryBySaveValue(l);this.findInputOnRow(i).prop("disabled",!0)}},enableSingleRow:function(e,t){if(_.isEqual(e,this.model)){var l=t.get("saveValue"),i=this.getRowJqueryBySaveValue(l);this.findInputOnRow(i).prop("disabled",!1)}},getRowJqueryBySaveValue:function(e){var t=IDT.cleanSaveVal(e),l=this.$('input[id="'+t+'"]');if(l.length>0)return l.parents("tr").eq(0);if(l=this.$('input[value="'+t+'"]'),l.length>0)return l.parents("tr").eq(0);var i=$();return this.$("tr").each(function(){var t=$(this),l=t.text();return l==e?void(i=t):void 0}),i},findInputOnRow:function(e){return e.find("input").eq(0)},initInfoRow:function(){this.getExportRow(),this.placeExportRow(),this.createSelectedItemsLabel()},getInfoRow:function(){return this.$el.parents(".dataTableContainer").find(".dataTables_info")},getSelectedItemsContainer:function(){return this.$el.parents(".dataTableContainer").find(".rowCount")},getRowWordContainer:function(){return this.$el.parents(".dataTableContainer").find(".rowWord")},placeExportRow:function(){var e=this.model.get("exportRow");if(null!==e){var t=$("<div></div>");t.css("float","left").addClass("tableExportAction").html(e);var l=this.getInfoRow();l.length>0&&l.after(t)}},getExportRow:function(){var e=this.$el.find("tr.tableRowAction");e.length>0&&this.model.set("exportRow",this.$el.find("td.tableCellAction").html()),e.parents("tr").eq(0).remove()},removeExportRow:function(){null!==this.model.get("exportRow")&&this.$el.find("td.tableCellAction").parents("tr").last().remove()},createSelectedItemsLabel:function(){if(this.getSelectedItemsContainer().length<1&&"none"!=this.model.get("inputType")){var e=this.getInfoRow(),t=$('<div class="rowCountContainer">(<span class="rowCount">0</span> <span class="rowWord">Rows</span> Selected)</div>');e.after(t)}},updateSelectedItemCount:function(){this.createSelectedItemsLabel();var e=this.model.selectedRows.length,t=this.getSelectedItemsContainer();t.text(e),this.updateRowWord(e)},getCountSelectedItems:function(){return this.getSelectedItemsContainer().text()},updateRowWord:function(e){var t="Rows";1==e&&(t="Row"),this.getRowWordContainer().text(t)},filterTable:function(e,t){_.isEqual(e,this.model)&&e.get("datatable").fnFilter(t)},isVisible:function(){return this.$el.is(":visible")},listenForVisible:function(){var e=500,t=this;this.isVisible()?IDT.recalculateHeaderFooterWidths(this.$el):setTimeout(function(){t.listenForVisible.call(t)},e)},deRender:function(e){_.isEqual(e,this.model)&&this.close()},close:function(){EventBus.off("draw:table",this.onDraw,this),EventBus.off("derender:table",this.deRender,this),EventBus.off("filter:table",this.filterTable,this);var e=this.model.get("datatable");e.fnDestroy(),DataTableView.__super__.close.call(this)},destroy:function(){this.close(),DataTableView.__super__.destroy.call(this)}});

// DataTableViews
var DataTableViews=Backbone.Collection.extend({initialize:function(){this.model=DataTableView}});

// IBISDataTables
var IbisDataTables=IDT={dataTables:{},tableReferences:[],models:null,isStarted:!1,initialize:function(){this.models=new DataTables,this.isStarted=!0},createNewTable:function(e){var t=this.getId(e),a=new DataTable({$el:e,id:t}),n=new DataTableView({model:a});return this.models.add(a),n},getTableModel:function(e){var t=this.getId(e);return this.models.findWhere({id:t})},buildSingleData:function(e,t,a){this.isStarted||this.initialize(),t.empty().addClass("table"),"undefined"==typeof a&&(a=this.createNewTable(t)),a.model.get("aaData").length<1&&(a.model.set("aaData",e.aaData),a.model.set("aoColumns",e.aoColumns),a.model.set("exportRow",e.exportRow),"undefined"!=typeof e.config&&a.model.set("config",e.config)),a.render()},buildSingleDom:function(e){this.isStarted||this.initialize();var t=this.createNewTable(e),a=t.getHeaderCells(),n=a.eq(0).parent("tr");n.remove(),t.getExportRow(),t.getBodyRows(e);var l={aaData:t.model.get("aaData"),aoColumns:t.model.get("aoColumns"),exportRow:t.model.get("exportRow")};this.buildSingleData(l,e,t)},fullBuild:function(e){this.isStarted||this.initialize();var t=e||$(".dataTableContainer > table");t.each(function(){_.defer(function(e){if(e.find('> script[type="text/json"]').length>0||e.parents(".dataTableContainer").hasClass("dataTableJSON")){var t=JSON.parse(e.find("script").html().trim());IDT.buildSingleData(t,e)}else IDT.buildSingleDom(e)},$(this))})},derenderTable:function(e){var t=this.getTableModel(e);"undefined"!=typeof t&&(EventBus.trigger("derender:table",t),this.models.remove(t))},isInit:function(e){var t=this.getTableModel(e);return"undefined"!=typeof t&&this.dataTables[t.get("id")]?!0:!1},getId:function(e){if(null!=e.attr("id"))return e.attr("id");var t=e.parents(".dataTableContainer").eq(0).id;return null!=t?t+="_table":t=window.location.pathname.split(".")[0].replace(/\//g,"_")+"_"+$(".dataTableContainer > table, .dataTableContainer > .dataTables_wrapper > table").index(e),e.attr("id",t),t},getInputForRow:function(e){return e.find("td").eq(0).find("input")},getVisTableRowInputs:function(e){var t=e.find("tbody tr"),a=$();return t.each(function(){a=a.add($(this).find('input[type="checkbox"], input[type="radio"]').eq(0))}),a},hasRowValue:function(e,t){var a=this.getTableModel(e),n=!1;return a.rows.forEach(function(e){return e.get("saveValue")==t?void(n=!0):void 0}),n},getSaveValue:function(e){var t=e;"undefined"!=typeof e.cid&&(t=e.getInput());var a=t.attr("id"),n=t.attr("value"),l="";return l=a&&null!=a?this.cleanSaveVal(a):n&&null!=n?this.cleanSaveVal(n):t.parents("tr").eq(0).text()},cleanSaveVal:function(e){return IDT.isSaveValClean(e)||(e=e.replace(/\./g,"\\.").replace(/ /g,"\\ ")),e},isSaveValClean:function(e){var t=e.indexOf(".")>-1,a=e.indexOf(" ")>-1,n=e.indexOf("\\.")>-1,l=e.indexOf("\\ ")>-1;return!(t&&!n||a&&!l)},setRowSelected:function(e){var t=this.getInputForRow(e),a=this.getSaveValue(t),n=this.getTable(e);"undefined"!=typeof n&&this.getTableModel(n).selectRow(a)},setRowDeselected:function(e){var t=this.getInputForRow(e),a=this.getSaveValue(t),n=this.getTable(e);"undefined"!=typeof n&&this.getTableModel(n).deselectRow(a)},hasOption:function(e,t){var a=this.getTableModel(e);return a.hasRow(t)},isSelectedOption:function(e,t,a){"undefined"==typeof a&&(a=this.getTable(e)),"undefined"==typeof t&&(t=this.getSaveValue(e));var n=this.getTableModel(a);return n.isSelectedSaveVal(t)},addSelectedOption:function(e,t,a){"undefined"==typeof a&&(a=this.getTable(e)),"undefined"==typeof t&&(t=this.getSaveValue(e));var n=this.getTableModel(a);n.selectRow(t)},addSelectedOptionValue:function(e,t){var a=this.getTableModel(e);a.selectRow(t)},removeSelectedOption:function(e,t,a){"undefined"==typeof a&&(a=this.getTable(e)),"undefined"==typeof t&&(t=this.getSaveValue(e));var n=this.getTableModel(a);n.deselectRow(t)},removeSelectedOptionValue:function(e,t){var a=this.getTableModel(e);a.deselectRow(t)},clearSelected:function(e){var t=this.getTableModel(e);t.deselectAll()},addRow:function(e,t){var a=this.getTableModel(e);if(null!=t)if(_.isArray(t))if(t[0]instanceof Row||_.isArray(t[0]))for(var n=0;n<t.length;n++)a.addNewRow(t[n]);else a.addNewRow(t);else a.addNewRow(t)},removeRow:function(e,t){var a=this.getTableModel(e);if(null!=t&&_.isArray(t))for(var n=0;n<t.length;n++)a.removeRow(t[n]);else a.removeRow(t)},removeAllRows:function(e){var t=this.getTableModel(e);t.removeAllRows()},getTable:function(e){var t=e;e.hasClass("dataTableContainer")||(t=e.parents(".dataTableContainer").eq(0));var a=t.find("table").eq(0);return"undefined"==typeof a?null:$(a)},getTableContainer:function(e){var t=e.parents(".dataTableContainer").eq(0);return"undefined"==typeof t?null:t},getSelectedOptions:function(e){var t=this.getTableModel(e);return t.getSelectedSaveVals()},getSelectedOptionsJq:function(e){var t=this.getSelectedOptions(e),a=$();if(t.length>0)for(var n=IDT.getVisTableRowInputs(e),l=0;l<n.length;l++){var i=n.eq(l),o=IDT.getSaveValue(i);-1!==t.indexOf(o)&&(a=a.add(i))}return a},setSelectedOptions:function(e,t){var a=this.getTableModel(e);a.deselectAll(),a.selectSet(t)},countSelectedOptions:function(e){var t=this.getTableModel(e);return t.selectedRows.length},disableSelection:function(e){var t=this.getTableModel(e);t.set("selectionDisable",!0),e.find("input").prop("disabled",!0)},enableSelection:function(e){var t=this.getTableModel(e);t.set("selectionDisable",!1),e.find("input").prop("disabled",!1)},disableSingleRow:function(e,t){var a=this.getTableModel(e),n="";n=t instanceof jQuery?IDT.getSaveValue(IDT.getInputForRow($row)):t,a.disableSingleRow(n)},enableSingleRow:function(e,t){var a=this.getTableModel(e),n="";n=t instanceof jQuery?IDT.getSaveValue(IDT.getInputForRow($row)):t,a.enableSingleRow(n)},disableSelectAll:function(e){var t=this.getTableModel(e);t.set("disableSelectAll",!0)},enableSelectAll:function(e){var t=this.getTableModel(e);t.set("disableSelectAll",!1)},filterTable:function(e,t){var a=this.getTableModel(e);EventBus.trigger("filter:table",a,t)},saveTableState:function(){},loadTableState:function(){},changeCheckboxSelection:function(e,t,a){"undefined"==typeof t&&(t=!0),"undefined"!=typeof a&&a.stopPropagation();var n=IDT.getSaveValue(e);e.prop("disabled",!0),setTimeout(function(){e.prop("disabled",!1)},250),this.model.toggleRow(n)},recalculateHeaderFooterWidths:function(e){e.each(function(){var e=$(this).parents(".dataTableContainer"),t=10;"Explorer"==BrowserDetect.browser&&(t+=2),e.find(".fg-toolbar").width($(this).width()-t)})},getCellContent:function(e,t,a){var n=this.getTableModel(e);return n.cellData(t,a)}};
